{"version":3,"sources":["src/_scripts/node_modules/browser-pack/_prelude.js","src/_scripts/src/_modules/pug-components/panel/panel.js","src/_scripts/src/_modules/pug-components/scripts/form-validation.js","src/_scripts/src/_modules/pug-components/scripts/service-handler.js","src/_scripts/src/_scripts/components.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Panel","$","queryElement","settings","_classCallCheck","this","slidereveal","that","name","extend","collapsable","autoEscape","overlay","position","push","speed","top","trigger","width","show","shown","hide","slideReveal","slider","TweenLite","to","className","find","fadeIn","removeClass","addClass","right","fadeOut","_serviceHandler","FormValidation","urls","rules","messages","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","vf","$domElement","validation","fv","valid","validate","normalizer","errorElement","errorClass","validClass","errorPlacement","error","element","closest","append","highlight","igi","unhighlight","on","prop","clearTimeout","st","setTimeout","url","data","token","getToken","req","ajax","Authorization","fail","jqXHR","textStatus","errorThrown","errorData","responseJSON","status","doneUserSelect","errorUserUpdate","errorUserEmail","error_description","done","resp","showErrors","email","_serviceHandler2","default","ServiceHandler","submit","todo","todoUrl","sh","submitH","preventDefault","target","serializeArray","concat","extraData","errorLogin","$template","html","filter","doneLogin","always","removeToken","location","assign","baseUrl","then","res","EsEmail","Deferred","reject","MailUnico","errorUserSelectFound","errorUserselectCallcenter","errorToken","headers","request","method","dataType","crossDomain","beforeSend","loading","complete","loadingStop","setToken","userSelect","sessionStorage","setItem","JSON","stringify","$input","modal","title","body","jsonResp","text","jJsonViewer","expanded","date","Date","now","parse","getItem","token_type","access_token","removeItem","id","base","_panel","_formValidation","window","modules","_panel2","_formValidation2"],"mappings":"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","file":"components.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","'use strict';\r\n\r\nexport default class Panel {\r\n  constructor($, queryElement, settings) {\r\n    let slidereveal = settings.slidereveal;\r\n    delete settings.slidereveal;\r\n\r\n    let that = this;\r\n    this.name = 'panel';\r\n    this.$ = $;\r\n\r\n    this.settings = $.extend({\r\n      collapsable: true,\r\n      slidereveal: $.extend({\r\n        autoEscape: true,\r\n        overlay: false,\r\n        position: 'left',\r\n        push: false,\r\n        speed: 600,\r\n        top: 132,\r\n        trigger: $('.panel .controls'),\r\n        width: '50%',\r\n        show: function () {\r\n          that.show();\r\n        },\r\n        shown: function () {\r\n          that.shown();\r\n        },\r\n        hide: function () {\r\n          that.hide();\r\n        }\r\n      }, slidereveal)\r\n    }, settings);\r\n    $(queryElement).slideReveal(this.settings.slidereveal).slideReveal('show');\r\n  }\r\n  show(slider, trigger) {\r\n    let $ = this.$;\r\n    // $('#main-content').addClass('offset-5');\r\n    TweenLite.to($('#main-content'), .6, { className: '+=offset-5' });\r\n    $(slider).find('.controls span').fadeIn();\r\n    $(slider).find('.controls i').removeClass('principal-arrow-right').addClass('principal-cross');\r\n    TweenLite.to($(slider).find('.trigger'), .6, { right: 0 });\r\n  }\r\n  shown(slider, trigger) {\r\n    let $ = this.$;\r\n    $(slider).find('.trigger').removeClass('bg-primary');\r\n  }\r\n  hide(slider, trigger) {\r\n    let $ = this.$;\r\n    // $('#main-content').removeClass('offset-5');\r\n    TweenLite.to($('#main-content'), .6, { className: '-=offset-5' });\r\n    $(slider).find('.controls span').fadeOut();\r\n    $(slider).find('.controls i').addClass('principal-arrow-right').removeClass('principal-cross');\r\n    TweenLite.to($(slider).find('.trigger'), .6, { right: -170 });\r\n    $(slider).find('.trigger').addClass('bg-primary');\r\n  }\r\n}\r\n","'use strict';\r\n//valida formularios y sincroniza con el servidor\r\n//TODO: separa en dos clases una que valide y otra que sincronice,\r\n//      además que sean abstractas y heredar de estas únicamente\r\n\r\nimport ServiceHandler from './service-handler';\r\n\r\nexport default class FormValidation extends ServiceHandler {\r\n  constructor($, queryElement, settings) {\r\n    settings = $.extend({\r\n      urls: {},\r\n      rules: {},\r\n      messages: {},\r\n      //url: 'http://principal-login.requestcatcher.com/'\r\n      //status code http\r\n      //https://httpstat.us/429\r\n      //https://httpstat.us/500 etc\r\n    }, settings);\r\n    super($, queryElement, settings);\r\n    this.$ = $;\r\n    let vf = this;\r\n    vf.settings = settings;\r\n    vf.$domElement = $(queryElement);\r\n    vf.validation();\r\n  }\r\n  validation() {\r\n    let $ = this.$;\r\n    let fv = this;\r\n    let $domElement = fv.$domElement.find('form').length ? fv.$domElement.find('form') : fv.$domElement;\r\n    fv.valid = $domElement.validate({\r\n      normalizer: true,\r\n      errorElement: 'p',\r\n      errorClass: 'is-invalid',\r\n      validClass: 'is-valid active',\r\n      rules: fv.settings.rules,\r\n      messages: fv.settings.messages,\r\n      errorPlacement: (error, element) => {\r\n        element.closest('.form-group').append(error.addClass('text-danger pl-3'));\r\n      },\r\n      highlight: (element, errorClass, validClass) => {\r\n        let igi = $(element).closest('.input-group-icon');\r\n        (igi.length > 0 ? igi : $(element)).addClass(errorClass).removeClass(validClass);\r\n      },\r\n      unhighlight: (element, errorClass, validClass) => {\r\n        let igi = $(element).closest('.input-group-icon');\r\n        (igi.length > 0 ? igi : $(element)).removeClass(errorClass).addClass(validClass);\r\n      }\r\n    });\r\n    $domElement.on('change', 'input, select, textarea', (e) => {\r\n      $domElement.find('[type=submit]').prop('disabled', !$domElement.valid());\r\n    });\r\n    $domElement.on('keyup', 'input, textarea', (e) => {\r\n      clearTimeout(fv.st);\r\n      fv.st = setTimeout(() => {\r\n        $domElement.find('[type=submit]').prop('disabled', !$domElement.valid());\r\n      }, 300);\r\n    });\r\n  }\r\n  userUpdate(url, data) {\r\n    let $ = this.$;\r\n    let fv = this;\r\n    //url += '/' + fv.$domElement[0].email.value;\r\n    let token = fv.getToken();\r\n    let req = fv.ajax(url, data, { 'Authorization': token });\r\n    req.fail((jqXHR, textStatus, errorThrown) => {\r\n      var errorData = jqXHR.responseJSON || {};\r\n      //{\"error\":\"invalid_grant\",\"error_description\":\"Error\"}\r\n      switch (jqXHR.status) {\r\n        case 200:\r\n          fv.doneUserSelect();\r\n          break;\r\n        case 304:\r\n          fv.errorUserUpdate();\r\n          break;\r\n        case 404:\r\n          fv.errorUserEmail();\r\n          break;\r\n        case 500: //se especifica que el error 500 va a dar al default\r\n        default:\r\n          fv.error(jqXHR.status, errorData.error_description || textStatus || 'Error', null, jqXHR);\r\n          break;\r\n      }\r\n    }).done(function (resp, textStatus, jqXHR) {\r\n      if (jqXHR.status == 304) {\r\n        fv.errorUserEmail();\r\n      } else {\r\n        fv.doneUserSelect();\r\n      }\r\n    });\r\n  }\r\n  errorUserUpdate() {\r\n    let vf = this;\r\n    vf.valid.showErrors({\r\n      email: vf.settings.messages.errorUserUpdate\r\n    });\r\n  }\r\n  errorUserEmail() {\r\n    let vf = this;\r\n    vf.valid.showErrors({\r\n      email: vf.settings.messages.errorUserEmail\r\n    });\r\n  }\r\n}\r\n","'use strict';\r\n\r\nexport default class ServiceHandler {\r\n  constructor($, queryElement, settings) {\r\n    settings = $.extend({\r\n      submit: true,\r\n      todo: null,//callback form before submit: string || function\r\n      todoUrl: null,//id of url\r\n      urls: {},\r\n      //url: 'http://principal-login.requestcatcher.com/'\r\n      //status code http\r\n      //https://httpstat.us/429\r\n      //https://httpstat.us/500 etc\r\n    }, settings);\r\n    let sh = this;\r\n    sh.settings = settings;\r\n    let $domElement = sh.$domElement = $(queryElement);\r\n    if (sh.settings.submit) {\r\n      let submitH = (e) => {\r\n        e.preventDefault();\r\n        let data = $(e.target).serializeArray();\r\n        data = data.concat(sh.extraData);\r\n        if (typeof sh.settings.todo === 'function') {\r\n          sh.settings.todo(sh, data);\r\n        } else if (typeof sh.settings.todo === 'string') {\r\n          sh[sh.settings.todo](sh.url(sh.settings.todoUrl), data);\r\n        }\r\n      };\r\n      if ($domElement.find('form').length) {\r\n        $domElement.on('submit', 'form', submitH);\r\n      } else {\r\n        $domElement.on('submit', submitH);\r\n      }\r\n    }\r\n  }\r\n  login(url, data) {\r\n    let sh = this;\r\n    let req = sh.ajax(url, data);\r\n    req.fail((jqXHR, textStatus, errorThrown) => {\r\n      var errorData = jqXHR.responseJSON || {};\r\n      //{\"error\":\"invalid_grant\",\"error_description\":\"Error\"}\r\n      switch (jqXHR.status) {\r\n        case 400:\r\n        case 401:\r\n          sh.errorLogin();\r\n          break;\r\n        case 429:\r\n          //como la etiqueta seleccionada es un script no se puede hacer $().find en el contenido\r\n          let $template = $($('#excessAttempts').html());\r\n          sh.error(jqXHR.status, $template.filter('.title').html(), $template.filter('.message').html());\r\n          break;\r\n        case 500: //se especifica que el error 500 va a dar al default\r\n        default:\r\n          sh.error(jqXHR.status, errorData.error_description || textStatus || 'Error', null);\r\n          break;\r\n      }\r\n    }).done(function (resp) {\r\n      sh.doneLogin(resp);\r\n    });\r\n  }\r\n  signout() {\r\n    let sh = this;\r\n    //url += '/' + sh.$domElement[0].email.value;\r\n    let token = sh.getToken();\r\n    let req = sh.ajax(sh.url('signout'), null, { 'Authorization': token });\r\n    req.always(function () {\r\n      sh.removeToken();\r\n      location.assign(baseUrl + 'logout/');\r\n    });\r\n    return req;\r\n  }\r\n  userSelect(url) {\r\n    let sh = this;\r\n    let token = sh.getToken();\r\n    let req = sh.ajax(url, null, { 'Authorization': token });\r\n    req.then(function (data, status, res) {\r\n      if (data.EsEmail == 'S') {\r\n        sh.doneUserSelect(data);\r\n      } else {\r\n        res.responseJSON = data;\r\n        return $.Deferred().reject(res, 'Error', 'Found');\r\n      }\r\n    }).fail((jqXHR, textStatus, errorThrown) => {\r\n      var errorData = jqXHR.responseJSON || {};\r\n      //{\"error\":\"invalid_grant\",\"error_description\":\"Error\"}\r\n      if (errorData.MailUnico) {\r\n        if (errorData.MailUnico == 'S') {\r\n          sh.errorUserSelectFound();\r\n        } else {\r\n          sh.errorUserselectCallcenter();\r\n        }\r\n      } else {\r\n        sh.error(jqXHR.status, errorData.error_description || textStatus || 'Error', null, jqXHR.responseJSON);\r\n      }\r\n    });\r\n  }\r\n  contracts() {\r\n    let sh = this;\r\n    //url += '/' + sh.$domElement[0].email.value;\r\n    let token = sh.getToken();\r\n    let req = sh.ajax(sh.url('contracts'), null, { 'Authorization': token });\r\n    req.fail((jqXHR, textStatus, errorThrown) => {\r\n      var errorData = jqXHR.responseJSON || {};\r\n      switch (jqXHR.status) {\r\n        case 401:\r\n          sh.errorToken();\r\n          break;\r\n        case 500: //se especifica que el error 500 va a dar al default\r\n        default:\r\n          sh.error(jqXHR.status, errorData.error_description || textStatus || 'Error');\r\n          break;\r\n      }\r\n    });\r\n    return req;\r\n  }\r\n  alias(url, data) {\r\n    let sh = this;\r\n    let token = sh.getToken();\r\n    let req = sh.ajax(sh.url('alias'), data, { 'Authorization': token });\r\n    req.fail((jqXHR, textStatus, errorThrown) => {\r\n      var errorData = jqXHR.responseJSON || {};\r\n      switch (jqXHR.status) {\r\n        case 401:\r\n          sh.errorToken();\r\n          break;\r\n        case 500: //se especifica que el error 500 va a dar al default\r\n        default:\r\n          sh.error(jqXHR.status, errorData.error_description || textStatus || 'Error');\r\n          break;\r\n      }\r\n    });\r\n    return req;\r\n  }\r\n  ajax(url, data, headers) {\r\n    let sh = this;\r\n    let request = $.ajax({\r\n      url: url,\r\n      data: data,\r\n      method: 'POST',\r\n      dataType: 'json',\r\n      crossDomain: true,\r\n      headers: headers,\r\n      beforeSend: () => {\r\n        sh.loading();\r\n      },\r\n      complete: () => {\r\n        sh.loadingStop();\r\n      }\r\n    });\r\n    return request;\r\n  }\r\n  doneLogin(data, textStatus, jqXHR) {\r\n    this.setToken(data);\r\n    this.userSelect(this.url('userSelect'));\r\n  }\r\n  doneUserSelect(data, textStatus, jqXHR) {\r\n    sessionStorage.setItem('user', JSON.stringify(data));\r\n    location.assign(baseUrl + 'dashboard/');\r\n  }\r\n  errorLogin() {\r\n    this.$domElement.find('#error-msg').show();\r\n    let $input = this.$domElement.find('.input-group-icon,:not(.input-group-icon)>.form-control');\r\n    $input.addClass('is-invalid');\r\n  }\r\n  errorUserSelectFound() {\r\n    //TODO: el nombre de usaurio está estático!!!! hay que cambiarlo para mostrar el que venga en los datos\r\n    $('.modal').modal('hide');\r\n    $('#update-account').modal('show');\r\n  }\r\n  errorUserselectCallcenter() {\r\n    let $template = $($('#callCenter').html());\r\n    this.error(300, $template.filter('.title').html(), $template.filter('.message').html());\r\n  }\r\n  errorToken() {\r\n    this.removeToken();\r\n    location.assign(baseUrl + 'login/');\r\n  }\r\n  error(status, title, body, jsonResp) {\r\n    $('.modal').modal('hide');\r\n    $('#errorCatcher').find('.modal-title span').text(title || 'Error');\r\n    $('#errorCatcher').find('.modal-body .message').html(body || '<p>Código de error: ' + status + '</p>');\r\n    if (jsonResp) {\r\n      $('#errorCatcher').find('.modal-body .message').append($('<p></p>').jJsonViewer(jsonResp, { expanded: true }));\r\n    }\r\n    $('#errorCatcher').modal('show');\r\n  }\r\n  setToken(resp) {\r\n    resp.date = Date.now();\r\n    sessionStorage.setItem('token', JSON.stringify(resp));\r\n  }\r\n  getToken() {\r\n    let resp = JSON.parse(sessionStorage.getItem('token'));\r\n    if (resp) {\r\n      return resp.token_type + ' ' + resp.access_token;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n  removeToken() {\r\n    sessionStorage.removeItem('token');\r\n  }\r\n  url(id) {\r\n    if (id == 'base') {\r\n      return this.settings.urls.base;\r\n    } else {\r\n      return this.settings.urls.base + this.settings.urls[id];\r\n    }\r\n  }\r\n  loading(queryElement) {\r\n    $(queryElement || this.$domElement).loading();\r\n  }\r\n  loadingStop(queryElement) {\r\n    $(queryElement || this.$domElement).loading('stop');\r\n  }\r\n  getExtraData() {\r\n    return this.extraData;\r\n  }\r\n  setExtraData(data) {\r\n    this.extraData = data;\r\n  }\r\n}","'use strict';\r\n\r\nimport Panel from '../_modules/pug-components/panel/panel';\r\nimport FormValidation from '../_modules/pug-components/scripts/form-validation';\r\n\r\nwindow.modules = {\r\n  Panel: Panel,\r\n  FormValidation: FormValidation\r\n};\r\n\r\n"]}